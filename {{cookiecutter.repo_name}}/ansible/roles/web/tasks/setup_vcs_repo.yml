{% raw %}---
- name: Authorized hosts for bitbucket
  shell: ssh-keyscan -H bitbucket.org >> /home/{{ deploy_user }}/.ssh/known_hosts
  args:
      creates: /home/{{ deploy_user }}/.ssh/known_hosts
  become: no
  tags:
      - hg
      - test

- name: Create the Sites Directory if not present 
  file: path={{ sites_dir }} owner={{ deploy_user }} state=directory
  tags:
      - web 
      - hg

- name: clone git repo 
  command: git clone {{ project_repo }} 
  when: vcs == 'git'
  become: no
  args:
      chdir: "{{ sites_dir }}"
      creates: "{{ sites_dir }}/{{ project_name }}"
  tags:
      - web 
      - hg
        
- name: clone hg repo
  command: hg clone {{ project_repo }} 
  when: vcs == 'hg'
  become: no
  args:
      chdir: "{{ sites_dir }}"
      creates: "{{ sites_dir }}/{{ project_name }}"
  tags:
      - web 
      - hg{% endraw %}
